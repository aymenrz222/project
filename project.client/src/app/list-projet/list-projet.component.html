<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:400,700|Material+Icons">
</head>
<body>
  <div class="content">
    <h1>Liste de projets </h1><br>
    <div class="container">
      <button type="button" (click)="toggleAddPopup()">
        <i class="material-icons"></i> Ajouter un projet
      </button>
    </div>
    <br><br> 
    <div class="dataTables_length bs-select" id="dtBasicExample_length">
      <label>Show
        <select 
          name="dtBasicExample_length" 
          aria-controls="dtBasicExample" 
          class="custom-select custom-select-sm form-control form-control-sm"
          (change)="onEntriesPerPageChange($event)">
          <option value="5">5</option>
          <option value="10">10</option>
          <option value="25">25</option>
        </select> entries
      </label>
    </div>
    <table *ngIf="showlistes"  id="dtBasicExample" class="table table-striped table-bordered table-sm" cellspacing="0" width="100%">
      <thead>
        <tr>
          <th><input type="checkbox"></th>
          <th>
            Titre
            <button type="button" class="btn btn-link btn-sm" (click)="sortByName()">
              <i class="material-icons">sort</i>
            </button>
          </th>
          <th scope="col">Projet Status</th>
          <th scope="col">Client</th>
          <th scope="col">Team</th>
          <th scope="col">date debut</th>
          <th scope="col">Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let project of (searchQuery ? filteredProjects : getProjectsForCurrentPage())">
          <td><input type="checkbox"></td>
          <td>{{ project.titre }}</td>
          <td>{{ project.projectStatus }}</td>
          <td>{{ project.client }}</td>
          <td *ngIf="project.teams && project.teams.length > 0">      {{ getnameteams(project.teams)}}  </td>    
          <td *ngIf="!project.teams ||project.teams.length === 0">      Aucun élément à afficher    </td>
          <td>{{ project.debutDate | date: 'dd/MM/yyyy'}}</td>
          <td>
            
            <button (click)="viewProject(project)" [disabled]="!isAdmin">
              <i class="material-icons">visibility</i>
            </button>
            <button (click)="openEditPopup(project)" [disabled]="!isAdmin">
              <i class="material-icons">edit</i>
            </button>
            <button (click)="deleteprojectConfirmation(project)" [disabled]="!isAdmin" >
              <i class="material-icons">close</i>
            </button><br>
            <span *ngIf="!isAdmin"><strong> ALERT : </strong>Action inaccessible pour les non-administrateurs</span>

          </td>
        </tr>
      </tbody>
    </table>
    <br><br>
    <div class="row">
      <div class="col-sm-12 col-md-5">
      <div class="dataTables_info" id="dtBasicExample_info" role="status" aria-live="polite">
          Showing {{ getFirstEntryIndex() }} to {{ getLastEntryIndex() }} of {{ listProjects.length }} entries
        </div>
      </div>
      <div class="col-sm-12 col-md-7">
        <div class="dataTables_paginate paging_simple_numbers" id="dtBasicExample_paginate">
          <ul class="pagination">
            <li class="paginate_button page-item" [class.disabled]="currentPage === 1" 
                (click)="changePage(currentPage - 1)">
              <a href="/list-projet/currentPage"aria-controls="dtBasicExample" data-dt-idx="0" tabindex="0" class="page-link">Previous</a>
            </li>
            <li class="paginate_button page-item" [class.active]="page === currentPage" *ngFor="let page of getPages()">
              <a href="/list-projet/currentPage" aria-controls="dtBasicExample"  tabindex="0" 
                 class="page-link" (click)="changePage(page)">{{ page }}</a>
            </li>
            <li class="paginate_button page-item" [class.disabled]="currentPage === getTotalPages()" 
                (click)="changePage(currentPage + 1)">
              <a href="/list-projet/{{ currentPage + 1 }}" aria-controls="dtBasicExample"  tabindex="0" 
                 class="page-link">Next</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    <!-- Angular Components -->
    <app-view [project]="project" *ngIf="openpopup" (ClosePopup)="handleClosePopup()"></app-view>
    <app-delete *ngIf="showConfirmation" [data]="Data" (confirmed)="deleteProject()"></app-delete>
    <app-ajout *ngIf="showAddPopup" (saveProject)="addProject()" (closePopup)="handleClosePopup()"></app-ajout>
    <app-edit *ngIf="showEditPopup"(savemodifiedProject)="saveModifiedProject()" [data]="Data" (closePopup)="closeEditPopup()"></app-edit>
  </div>
</body>
</html>
